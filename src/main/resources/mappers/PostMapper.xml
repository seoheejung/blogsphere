<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.blogsphere.repository.mybatis.PostMapper">
    <!-- 페이징 처리를 위한 글 목록 조회 -->
    <select id="findPostsByPage" resultType="Post">
        SELECT * FROM posts LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- 글의 상세 정보 조회 -->
    <select id="findPostDetailById" resultType="Post">
        SELECT p.*, 
            c.name AS categoryName, 
            (SELECT COUNT(*) FROM comments WHERE post_id = p.id) AS commentCount 
        FROM posts p 
        LEFT JOIN categories c ON p.category_id = c.id 
        WHERE p.id = #{postId}
    </select>

    <!-- 결과 매핑 정의 (필요한 경우) -->
    <resultMap id="postResultMap" type="Post">
        <id property="id" column="id" />
        <result property="blogId" column="blog_id" />
        <result property="title" column="title" />
        <result property="content" column="content" />
        <result property="visibility" column="visibility" />
        <result property="categoryId" column="category_id" />
        <result property="published" column="published" />
        <result property="tag" column="tag" />
        <result property="acceptComment" column="accept_comment" />
        <result property="password" column="password" />
        <result property="categoryName" column="categoryName" />
        <result property="commentCount" column="commentCount" />
    </resultMap>
    
</mapper>
